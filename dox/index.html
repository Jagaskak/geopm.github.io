<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>geopm: Main Page</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">geopm
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li class="current"><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">geopm Documentation</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h2>DISCLAIMER </h2>
<p>SEE COPYING FILE FOR LICENSE INFORMATION.</p>
<h2>LAST UPDATE </h2>
<p>2017 June 17</p>
<p>Christopher Cantalupo <a href="#" onclick="location.href='mai'+'lto:'+'chr'+'is'+'top'+'he'+'r.m'+'.c'+'ant'+'al'+'upo'+'@i'+'nte'+'l.'+'com'; return false;">chris<span style="display: none;">.nosp@m.</span>toph<span style="display: none;">.nosp@m.</span>er.m.<span style="display: none;">.nosp@m.</span>cant<span style="display: none;">.nosp@m.</span>alupo<span style="display: none;">.nosp@m.</span>@int<span style="display: none;">.nosp@m.</span>el.co<span style="display: none;">.nosp@m.</span>m</a> <br/>
 Steve Sylvester <a href="#" onclick="location.href='mai'+'lto:'+'ste'+'ve'+'.s.'+'sy'+'lve'+'st'+'er@'+'in'+'tel'+'.c'+'om'; return false;">steve<span style="display: none;">.nosp@m.</span>.s.s<span style="display: none;">.nosp@m.</span>ylves<span style="display: none;">.nosp@m.</span>ter@<span style="display: none;">.nosp@m.</span>intel<span style="display: none;">.nosp@m.</span>.com</a></p>
<h2>WEB PAGES </h2>
<p><a href="http://geopm.github.io/geopm">http://geopm.github.io/geopm</a> <br/>
 <a href="http://geopm.github.io/geopm/man/geopm.7.html">http://geopm.github.io/geopm/man/geopm.7.html</a></p>
<h2>SUMMARY </h2>
<p>Global Extensible Open Power Manager (GEOPM) is an extensible power management framework targeting high performance computing. The library can be extended to support new control algorithms and new hardware power management features. The GEOPM package provides built in features ranging from static management of power policy for each individual compute node, to dynamic coordination of power policy and performance across all of the compute nodes hosting one MPI job on a portion of a distributed computing system. The dynamic coordination is implemented as a hierarchical control system for scalable communication and decentralized control. The hierarchical control system can optimize for various objective functions including maximizing global application performance within a power bound. The root of the control hierarchy tree can communicate through shared memory with the system resource management daemon to extend the hierarchy above the individual MPI job level and enable management of system power resources for multiple MPI jobs and multiple users by the system resource manager. The geopm package provides the libgeopm library, the libgeopmpolicy library, the geopmctl application and the geopmpolicy application. The libgeopm library can be called within MPI applications to enable application feedback for informing the control decisions. If modification of the target application is not desired then the geopmctl application can be run concurrently with the target application. In this case, target application feedback is inferred by querying the hardware through Model Specific Registers (MSRs). With either method (libgeopm or geopmctl), the control hierarchy tree writes processor power policy through MSRs to enact policy decisions. The libgeopmpolicy library is used by a resource manager to set energy policy control parameters for MPI jobs. Some features of libgeopmpolicy are available through the geopmpolicy application including support for static control.</p>
<h2>TRAVIS CI </h2>
<p><a href="https://travis-ci.org/geopm/geopm">![Build Status](https://travis-ci.org/geopm/geopm.svg)</a></p>
<p>The geopm public github project has been integrated with Travis continuous integration.</p>
<p><a href="http://travis-ci.org/geopm/geopm">http://travis-ci.org/geopm/geopm</a></p>
<p>All pull requests will be built and tested automatically by Travis. Additionally, pushes to the public dev and master branches which pass testing in Travis will trigger build and test in the OpenSUSE Build System (OBS) for a variety of Linux distributions. These provide yum and zypper repositories which can be used to install the geopm software.</p>
<h2>INSTALL </h2>
<p>The products of OBS triggered by Travis CI can be installed directly on a number of Linux distributions through yum or zypper. Build and test are currently passing on CentOS 7, RHEL 7, SLES 12, SLES 12-1, Fedora 21, Fedora 22 and Fedora 23. Release 0.2.0 is the first to include distribution on OBS. Pushes to the github public master branch are done only after a release has been tagged, and these tagged releases are published in yum and zypper repositories at the link below:</p>
<p><a href="http://download.opensuse.org/repositories/home:/cmcantalupo:/geopm">http://download.opensuse.org/repositories/home:/cmcantalupo:/geopm</a></p>
<p>The tagged releases should be more stable and more accurately documented than the tip of the public dev branch which is updated frequently. These frequent pushes to the public development branch can also be used as yum and zypper repositories. These are published at the link below:</p>
<p><a href="http://download.opensuse.org/repositories/home:/cmcantalupo:/geopm-dev">http://download.opensuse.org/repositories/home:/cmcantalupo:/geopm-dev</a></p>
<p>Use of these repositories should be helpful for developers of geopm who are willing to update the installed version frequently.</p>
<h3>Red Hat</h3>
<p>To install the yum repository follow the commands below. Select the DISTRO appropriate for you system. Select the BRANCH as "geopm" or "geopm-dev" to follow either the "master" or "dev" branches of repository hosted at <a href="http://github.com/geopm/geopm">http://github.com/geopm/geopm</a>. </p>
<pre class="fragment">DISTRO=# Select from: "CentOS_7" "RHEL_7" "Fedora_23" "Fedora_24"
BRANCH=# Select from: "geopm" or "geopm-dev"
ROOT="home:/cmcantalupo:"
REPO=$(echo $ROOT | sed 's|/||')
wget http://download.opensuse.org/repositories/${ROOT}/${BRANCH}/${DISTRO}/${REPO}${BRANCH}.repo
sudo install --mode 644 ${REPO}${BRANCH}.repo /etc/yum.repos.d/${BRANCH}.repo
unset DISTRO BRANCH ROOT REPO
</pre><p>After the yum repository has been added, you can simply install geopm with yum: </p>
<pre class="fragment">sudo yum install geopm # For headers install geopm-devel
</pre><p>To bring the system up to date with the tip of the public master or dev branch on github (depending on which "BRANCH" was selected when the yum repository was added: </p>
<pre class="fragment">sudo yum update geopm # For headers update geopm-devel
</pre><h3>SUSE</h3>
<p>To install the zypper repository follow the commands below. Select the DISTRO appropriate for you system. Select the BRANCH as "geopm" or "geopm-dev" to follow either the "master" or "dev" branches of repository hosted at <a href="http://github.com/geopm/geopm">http://github.com/geopm/geopm</a>. </p>
<pre class="fragment">DISTRO=# Select from: "SLE_12" or "SLE_12_SP1"
BRANCH=# Select from: "geopm" or "geopm-dev"
ROOT="home:/cmcantalupo:"
REPO=$(echo $ROOT | sed 's|/||')
sudo zypper addrepo http://download.opensuse.org/repositories/${ROOT}/${BRANCH}/${DISTRO}/${REPO}${BRANCH}.repo ${BRANCH}
sudo zypper refresh
unset DISTRO BRANCH ROOT REPO
</pre><p>After the zypper repository has been added, you can simply install geopm with zypper: </p>
<pre class="fragment">sudo zypper install geopm # For headers install geopm-devel
</pre><p>To bring the system up to date with the tip of the public master or dev branch on github (depending on which "BRANCH" was selected when the zypper repository was added: </p>
<pre class="fragment">sudo zypper update geopm # For headers update geopm-devel
</pre><h2>PYTHON INSTALL </h2>
<p>The GEOPM python tools are packaged in the RPMs described above, but they are also available from PYPI as the <code>geopmpy</code> package. For example to install the geopmpy package into your home directory run the following command: </p>
<pre class="fragment">pip install --user geopmpy
</pre><p>Note this installs only the GEOPM python tools and does not install the full GEOPM runtime.</p>
<h2>BUILD REQUIREMENTS </h2>
<p>In order to build the geopm package from source, the below requirements must be met.</p>
<p>The geopm package requires a compiler that supports the MPI 2.2 and C++11 standards. These requirements can be met by using GCC version 4.7 or greater and installing the openmpi-devel package version 1.7 or greater on RHEL or SLES Linux. Additionally building the geopm package requires the json-c library and the hwloc library. Documentation creation including manpages further requires the rubygems package, and the ruby-devel package.</p>
<p>RHEL: </p>
<pre class="fragment">yum install openmpi-devel json-c-devel hwloc-devel ruby-devel rubygems
</pre><p>SUSE: </p>
<pre class="fragment">zypper install openmpi-devel libjson-c-devel hwloc-devel ruby-devel rubygems
</pre><p>Alternatively these can be installed from source, and an alternate MPI implementation to OpenMPI can be selected. See </p>
<pre class="fragment">./configure --help
</pre><p>for details on how to use non-standard install locations for build requirements through the </p>
<pre class="fragment">./configure --with-&lt;feature&gt;
</pre><p>options.</p>
<h2>BUILD INSTRUCTIONS </h2>
<p>The source code can be rebuilt from the source RPMs available from the links in the INSTALL section using rpmbuild. To build from the git repository follow the instructions below.</p>
<p>To build all targets and install it in a "build/geopm" subdirectory of your home directory run the following commands: </p>
<pre class="fragment">./autogen.sh
./configure --prefix=$HOME/build/geopm
make
make install
</pre><p>An RPM can be created on a RHEL or SUSE system with the </p>
<pre class="fragment">make rpm
</pre><p>target. Note that the &ndash;with-mpi-bin option may be required to inform configure about the location of the MPI compiler wrappers. The following command may be sufficient to determine the location: </p>
<pre class="fragment">dirname $(find /usr -name mpicc)
</pre><p>To build in an environment without support for OpenMP (i.e. clang on Mac OS X) use the </p>
<pre class="fragment">./configure --disable-openmp
</pre><p>option. The </p>
<pre class="fragment">./configure --disable-mpi
</pre><p>option can be used to build only targets which do not require MPI. By default MPI targets are built.</p>
<h2>RUN REQUIREMENTS </h2>
<p>We are targeting SLES12 and RHEL7 distributions for functional runtime support. There are several runtime requirements that can be obtained from those distributions including the OpenMPI implementation of MPI, the json-c library, and the hwloc library. To install follow the instructions below for your Linux distribution.</p>
<p>RHEL: </p>
<pre class="fragment">yum install openmpi json-c hwloc
</pre><p>SUSE: </p>
<pre class="fragment">zypper install openmpi libjson-c hwloc
</pre><h3>MSR DRIVER</h3>
<p>The msr-safe kernel driver must be loaded at runtime to support user level read and write of white-listed MSRs. The source code for the driver can be found here: <a href="https://github.com/scalability-llnl/msr-safe">https://github.com/scalability-llnl/msr-safe</a>.</p>
<p>Alternately you can run geopm as root with the standard msr driver loaded: </p>
<pre class="fragment">modprobe msr
</pre><p>Note that other Linux mechanisms for power management can interfere with geopm, and these must be disabled. We suggest the following: </p>
<pre class="fragment">echo performance | tee /sys/devices/system/cpu/cpu*/cpufreq/scaling_governor
</pre><p>and adding "intel_pstate=disable" to the kernel command line through grub2.</p>
<h3>GEOPM MPI LAUNCH WRAPPER</h3>
<p>The GEOPM package installs two commands: "geopmsrun" and "geopmaprun" which are wrappers for the MPI launch commands "srun" and "aprun" respectively. These wrappers enable exactly the same command line interface as the underlying launch command, but the wrapper extends the interface with GEOPM specific options. When the "--geopm-ctl" option is passed to the wrapper it will launch the GEOPM runtime with your application while enforcing the GEOPM requirements by manipulating the options passed to the underlying launch command ("srun" or "aprun"). This includes handling the CPU affinity requirements and getting the GEOPM control process on each node up and ready to connect to the main compute application. The wrapper is documented in the geopmsrun(1) and geopmaprun(1) man pages.</p>
<p>If your system uses an MPI launch command other than "srun" or "aprun", or if your application requires some specialized use of these commands, then check the geopm_aprun(3) / geopm_srun(3) man page description of the "--geopm-rm" option which selects from other available launch mechanisms. If the launch mechanism for your system is not implemented, then affinity requirements must be enforced by the user. Also, please consult the <a class="el" href="classgeopm.html">geopm(7)</a> man page for documentation of the environment variables used by the GEOPM runtime that are otherwise controlled by the wrapper script.</p>
<h3>CPU AFFINITY REQUIREMENTS</h3>
<p>The GEOPM runtime requires that each MPI process of the application under control is affinitized to distinct CPUs. This is a strict requirement for the runtime and must be enforced by the MPI launch command.</p>
<p>Affinitizing the GEOPM control thread to a CPU that is distinct from the application CPUs may improve performance of the application, but this is not a requirement. On systems where an application achieves highest performance when leaving a CPU unused by the application so that this CPU can be dedicated to the operating system, it is usually best to affinitize the GEOPM control thread to this CPU designated for system threads.</p>
<p>There are many ways to launch an MPI application, and there is no single uniform way of enforcing MPI rank CPU affinities across different job launch mechanisms. Additionally, OpenMP runtimes, which are associated with the compiler choice, have different mechanisms for affinitizing OpenMP threads within CPUs available to each MPI process. To complicate things further the GEOPM control thread can be launched as an application thread or a process that may be part of the primary MPI application or a completely separate MPI application. For these reasons it is difficult to document how to correctly affinitize processes in all configurations. Please refer to your site documentation about CPU affinity for the best solution on the system you are using.</p>
<h2>TESTING </h2>
<p>From within the source code directory, tests can be executed with the "make check" target. Some tests must be run as MPI applications, and in order support these tests you must define the "MPIEXEC" environment variable to whatever is appropriate for your your MPI runtime (default is mpiexec). The tests assume that this application will respect the '-n' flag to set the number of MPI processes. Note that '-n' is defined by the MPI standard. Each MPI dependent test is run with 16 MPI processes.</p>
<h2>STATUS </h2>
<p>This software is alpha versioned and is provided for early adopters and collaborative development. We are very interested in feedback from the community. The runtime implements the infrastructure and basic features targeted for GEOPM version 1.0. We do not anticipate changes to application facing interfaces of our libraries or the command line interfaces of our executables until after version 1.0. Before the beta release we will change the way signals and controls are interfaced to decider plugins. These changes will enable easier and more efficient extension of signals and controls as well as support for multiple domain definitions where signals and controls pertain. We will also be expanding our integration test feature coverage, and our unit test line coverage before beta release. See TODO file for links to descriptions of forthcoming work.</p>
<p>Test coverage is incomplete. The line coverage results from gcov as reported by gcovr for the latest release can be found here: <a href="http://geopm.github.io/geopm/coverage/index.html">http://geopm.github.io/geopm/coverage/index.html</a></p>
<h2>ACKNOWLEDGMENTS </h2>
<p>Development of the GEOPM software package has been partially funded through contract B609815 with Argonne National Laboratory. </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.6
</small></address>
</body>
</html>
